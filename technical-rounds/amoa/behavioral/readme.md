
AWS basics:


The Noob guide:

EC2

- There are regions and each region has 1 or more availability zones
- Matters because you can choose which region to launch
- First sign in to console.
- Go to solutions page - here you give problem and they tell which services you need.
- Let us first look at EC2: Elastic Cloud Computing.
  - Here you can start virtual instances of servers & you can decide how powerful the servers should be.
  - On the server you can install a webserver, an interpreter and host website.
  - In EC2 you can start instance and choose region
  - When you create instance choose which image you want to install. Images contain OS + tools like mysql, php, docker
  - Then choose how many instances to start, choose what storage you want. This is not persistent though so you must use S3 (simple storage service) 
  - Launch. On launching you are asked to download key/value pairs. Required to connect from local machine because server is in cloud. We must connect to it through cmd and to identify, we need key/val pairs.
  - Elastic benastalk can do all this for us. We simply need to zip code and upload it.
  - Configure server. Here you have instances, env settings etc, load balancer, databases, command line command etc
  - Create app.

Hosting static website

- Let us look at how to launch static app:
  - S3: used to upload website code
  - Cloudfront: Deliver website over CDN
  - Route 53: DNS service
  - Cert manager: So that https will be enabled
- Architecture is as follows:
  - Website hosted on S3 bucket configured as origin to cloudfront
  - Cert from cert manager is applied to cloudfront so website supports ssl
  - Route53: When request comes to www.domainname.com route53 redirects it to cloudfront. Cloudfront caches requests to website so next time users want to visit we can get route from cache
- Once you have domain, configure route53. 
  - Input your domain name to route53 and it will create a hosted zone
  - We get name-server values. Copy/paste name server value on the domain config so DNS resolution can be done through aws. Replace default nameserver provided by godaddy etc with aws nameserver
- Next create S3 bucket
  - Bucket name = domain name
  - Configure website as static website. Enter index.html and error.html. Upload site from bucket.
  - Configure permissions in bucket policy. Policy is in documentation.
  - Now you can get endpoint and users can see website.
- Now I want user to access through domain name instead of endpoint. To do this we must serve site through cloudfront
  - Create distribution for website
  - Type origin domain name: This is the endpoint generated by s3 bucket and create.
  - In alternate domain name, type in your domain.
  - Set SSL cert by requesting cert from ACM (Amazon cert manager). Type in domain name and request and create record in route53.
  - Go to route53 and paste your cloudfronts domain in it.
  
  
AWS re:invent 2015 - scaling to 10 mil users


Global infrastructure:

- AWS has availability zones in different regions (think of them as data centers, 1 az = 1 datacenter there are multiple)
  - Important when you scale
  - Provides availability in region
  - Many services leverage the availability zones
  - Allow you to use multiple availability zones to architect your apps for high availability
- Edge locations: Just like regions/availability zones.
  - Used in 2 services the CDN cloudfront and route 53 DNS service
  - Lets users get content at very low latency globally

Scaling:

1 User

- When you have just 1 user you need:
  - Route53 to route stuff
  - EC2 instance with full stack
  - Elastic IP (cloudfront) + domain

More than 100 users

- At some point we need a bigger computer. And AWS can do that. (vertical scaling)
- But you reach a limit at some point.
- Take DB and move it off the web server
  - Lets us scale tiers of app independently.
  - Start using a managed db service.

Managing the DB

- You can either manage DB yourself or you can have fully managed DB using AWS.
- RDS is relational DB, DynamoDb is for nosql, Redshift is for parallel computing + big data (petabyte scale warehousing)
- Now you must choose SQL vs NoSQL. Start with a relational DB as it is an old database and shit is known. If you have massive data, then use NoSQL.
- Separate single host to more than 1. Pur DB into an Amazon RDS database (MySQL db)

More than 1000 users

- Now you must think of availability. Create another instance in a different availability zone and add a slave DB for second instance.
- No application change needed because it is the same endpoint - app does not need to concern itself with the slave.
- Add elastic load balancer (ELB) to ensure that traffic goes to both zones. ELB also has health checks to see status of instances and if they work.

More than 100000 users

- Scale horizontally. Have many read replicas. Let master handle writes and all the read replicas handle reads.

Performance and Efficiency:

- Lighten the load: Move static content to S3 instance. S3 is not something you attach to EC2 instance but it is good to put static content like javascript, css, images etc in S3.
- Get session state out of web tier. Stick it in DynamoDB
- Use elastic cache. If I have data accessed all the time, use a cache.

More than 500k users

- Use autoscaling groups on web servers across different regions.
- 1 autoscaling group should be used for multiple availability zones in same region.
- Use automation
  - You can use EC2 and do automation on your own
  - Or you an use stuff like Elastic Beanstalk.
- Monitor the users/website
